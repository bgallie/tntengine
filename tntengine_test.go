// This is free and unencumbered software released into the public domain.
// See the UNLICENSE file for details.

package tntengine

import (
	"math/big"
	"reflect"
	"testing"
)

func TestTntEngine_Left(t *testing.T) {
	var tntMachine TntEngine
	tntMachine.Init([]byte("SecretKey"))
	tntMachine.SetEngineType("E")
	tntMachine.BuildCipherMachine()
	tests := []struct {
		name string
		want chan CipherBlock
	}{
		{
			name: "ttel1",
			want: tntMachine.left,
		},
	}
	for _, tt := range tests {
		e := tntMachine
		t.Run(tt.name, func(t *testing.T) {
			if got := e.Left(); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("TntEngine.Left() = %v, want %v", got, tt.want)
			}
		})
	}
	var blk CipherBlock
	tntMachine.left <- blk
	<-tntMachine.right
}

func TestTntEngine_Right(t *testing.T) {
	var tntMachine TntEngine
	tntMachine.Init([]byte("SecretKey"))
	tntMachine.SetEngineType("E")
	tntMachine.BuildCipherMachine()
	tests := []struct {
		name string
		want chan CipherBlock
	}{
		{
			name: "tter1",
			want: tntMachine.right,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			e := tntMachine
			if got := e.Right(); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("TntEngine.Right() = %v, want %v", got, tt.want)
			}
		})
	}
	var blk CipherBlock
	tntMachine.left <- blk
	<-tntMachine.right
}

func TestTntEngine_CounterKey(t *testing.T) {
	var tntMachine TntEngine
	tests := []struct {
		name string
		key  string
		want string
	}{
		{
			name: "ttec1",
			key:  "SecretKey",
			want: "30a7c225e88daa83416dee1970dc58b81f0c3771d6eb801ce23b49439357cc16",
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			tntMachine.Init([]byte(tt.key))
			if got := tntMachine.CounterKey(); got != tt.want {
				t.Errorf("TntEngine.CounterKey() = %v, want %v", got, tt.want)
			}
		})
	}
}

func TestTntEngine_Index(t *testing.T) {
	var tntMachine TntEngine
	tntMachine.Init([]byte("SecretKey"))
	iCnt, _ := new(big.Int).SetString("1234567890", 10)
	tntMachine.SetIndex(iCnt)
	tests := []struct {
		name     string
		wantCntr *big.Int
	}{
		{
			name:     "ttei1",
			wantCntr: iCnt,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			e := tntMachine
			if gotCntr := e.Index(); !reflect.DeepEqual(gotCntr, tt.wantCntr) {
				t.Errorf("TntEngine.Index() = %v, want %v", gotCntr, tt.wantCntr)
			}
		})
	}
}

func TestTntEngine_SetIndex(t *testing.T) {
	var tntMachine TntEngine
	tntMachine.Init([]byte("SecretKey"))
	iCnt, _ := new(big.Int).SetString("1234567890", 10)
	type args struct {
		iCnt *big.Int
	}
	tests := []struct {
		name string
		args args
		want *big.Int
	}{
		{
			name: "ttesi1",
			args: args{iCnt},
			want: iCnt,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			e := tntMachine
			e.SetIndex(tt.args.iCnt)
			if got := e.Index(); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("TntEngine.Index() = %v, want %v", got, tt.want)
			}
		})
	}
}

func TestTntEngine_SetEngineType(t *testing.T) {
	var tntMachine TntEngine
	tntMachine.Init([]byte("SecretKey"))
	type args struct {
		engineType string
	}
	tests := []struct {
		name string
		args args
	}{
		{
			name: "tteset1",
			args: args{"E"},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			e := tntMachine
			e.SetEngineType(tt.args.engineType)
			if got := e.engineType; got != tt.args.engineType {
				t.Errorf("TntEngine.SetEngineType() = %v, want %v", got, tt.args.engineType)
			}
		})
	}
}

func TestTntEngine_Engine(t *testing.T) {
	var tntMachine TntEngine
	tntMachine.Init([]byte("SecretKey"))
	tntMachine.SetIndex(BigZero)
	cnter := new(Counter)
	cnter.SetIndex(BigZero)
	tests := []struct {
		name string
		want []Crypter
	}{
		{
			name: "tnte1",
			want: []Crypter{
				new(Rotor).New(1783, 201, 1696, []byte{
					162, 147, 81, 248, 75, 180, 188, 20, 149, 19, 88, 64, 129, 204, 166, 94,
					177, 188, 48, 70, 127, 234, 235, 114, 94, 158, 209, 76, 168, 213, 33, 126,
					226, 225, 199, 129, 114, 211, 99, 163, 7, 211, 115, 227, 19, 27, 83, 104,
					239, 147, 24, 50, 60, 186, 116, 188, 132, 147, 170, 201, 220, 129, 26, 71,
					243, 139, 78, 231, 148, 125, 208, 190, 185, 254, 186, 105, 70, 229, 125, 122,
					227, 158, 165, 34, 136, 213, 17, 39, 197, 239, 214, 178, 245, 251, 174, 116,
					215, 102, 141, 122, 199, 44, 161, 15, 139, 9, 84, 131, 222, 248, 236, 196,
					133, 237, 156, 191, 4, 164, 56, 106, 222, 237, 210, 242, 173, 20, 245, 93,
					98, 52, 114, 108, 19, 113, 243, 81, 156, 166, 189, 174, 243, 119, 79, 41,
					225, 64, 121, 8, 209, 139, 131, 140, 84, 199, 137, 161, 174, 121, 25, 176,
					161, 137, 64, 152, 46, 178, 24, 69, 233, 39, 186, 167, 190, 86, 64, 228,
					147, 233, 97, 205, 214, 231, 54, 63, 166, 109, 151, 67, 246, 215, 227, 200,
					132, 243, 17, 168, 102, 173, 209, 55, 53, 22, 240, 32, 138, 218, 147, 184,
					178, 210, 150, 41, 133, 11, 135, 203, 185, 107, 58, 162, 221, 119, 56, 209,
					201, 40, 252, 37, 90, 94, 138, 202, 9, 44, 160, 64, 102, 83, 175, 88,
					94, 24, 163, 63, 245, 117, 57, 47, 207, 104, 38, 212, 234, 16, 191, 143}),
				new(Rotor).New(1789, 60, 444, []byte{
					153, 247, 84, 55, 230, 25, 164, 59, 126, 236, 221, 4, 209, 236, 84, 230,
					139, 111, 14, 137, 166, 224, 21, 71, 61, 4, 139, 183, 101, 78, 5, 174,
					94, 15, 206, 125, 202, 48, 228, 146, 191, 224, 132, 235, 224, 60, 18, 57,
					21, 103, 237, 61, 115, 105, 9, 46, 125, 96, 212, 84, 255, 99, 31, 143,
					174, 229, 231, 55, 87, 140, 24, 250, 254, 223, 11, 189, 225, 224, 128, 159,
					129, 148, 123, 81, 207, 187, 23, 163, 124, 181, 23, 212, 9, 96, 174, 161,
					11, 53, 94, 248, 208, 200, 122, 100, 102, 100, 45, 238, 228, 196, 203, 100,
					117, 33, 216, 253, 197, 158, 136, 53, 250, 119, 30, 142, 163, 134, 22, 166,
					102, 243, 12, 64, 209, 28, 91, 75, 121, 204, 74, 86, 124, 140, 230, 173,
					195, 100, 183, 11, 232, 204, 89, 52, 21, 92, 150, 81, 254, 153, 112, 222,
					32, 98, 73, 34, 119, 148, 167, 165, 12, 11, 53, 195, 237, 110, 79, 173,
					225, 142, 171, 222, 45, 213, 183, 40, 170, 51, 39, 178, 180, 11, 10, 218,
					75, 126, 31, 114, 113, 104, 95, 47, 116, 114, 106, 239, 24, 178, 51, 215,
					50, 253, 234, 33, 107, 175, 142, 70, 143, 130, 146, 226, 96, 45, 123, 45,
					243, 158, 234, 198, 60, 131, 116, 199, 143, 189, 155, 32, 154, 157, 202, 124,
					241, 205, 33, 209, 20, 188, 226, 168, 135, 96, 241, 182, 204, 169, 192, 245}),
				new(Permutator).New(256, []byte{
					2, 54, 236, 59, 71, 24, 38, 151, 82, 45, 214, 178, 37, 135, 46, 72,
					226, 87, 160, 25, 188, 122, 155, 109, 57, 95, 127, 93, 23, 202, 159, 217,
					175, 213, 198, 210, 34, 44, 230, 207, 197, 30, 77, 36, 120, 29, 154, 153,
					194, 62, 58, 240, 255, 158, 80, 123, 139, 114, 163, 149, 252, 136, 65, 143,
					215, 61, 88, 220, 182, 204, 205, 171, 174, 164, 73, 208, 78, 199, 8, 116,
					35, 250, 157, 172, 167, 113, 144, 166, 173, 242, 219, 203, 165, 132, 104, 195,
					92, 227, 251, 11, 129, 15, 209, 168, 76, 161, 243, 41, 22, 118, 111, 212,
					26, 5, 53, 187, 124, 231, 239, 97, 200, 229, 191, 10, 169, 98, 196, 145,
					179, 89, 4, 225, 216, 3, 128, 9, 112, 96, 186, 133, 221, 148, 162, 223,
					68, 237, 40, 28, 81, 121, 74, 52, 48, 189, 42, 99, 235, 150, 218, 241,
					101, 125, 108, 253, 248, 152, 137, 67, 55, 84, 211, 110, 50, 249, 134, 60,
					245, 185, 126, 56, 63, 206, 106, 18, 147, 20, 107, 69, 0, 234, 115, 176,
					21, 192, 117, 14, 16, 140, 170, 47, 138, 247, 105, 49, 228, 100, 64, 102,
					184, 7, 66, 233, 90, 183, 13, 232, 94, 12, 156, 91, 254, 246, 141, 27,
					222, 6, 19, 39, 224, 190, 238, 31, 32, 51, 33, 79, 146, 131, 119, 201,
					103, 180, 75, 130, 86, 83, 142, 17, 244, 85, 70, 181, 1, 177, 193, 43}),
				new(Rotor).New(1753, 939, 733, []byte{
					133, 200, 54, 134, 171, 75, 98, 226, 14, 62, 202, 225, 97, 86, 59, 170,
					247, 181, 161, 83, 153, 146, 154, 161, 216, 13, 104, 65, 44, 147, 139, 109,
					64, 24, 15, 15, 20, 210, 164, 232, 55, 191, 221, 193, 68, 19, 40, 104,
					159, 3, 250, 171, 226, 236, 1, 55, 110, 23, 82, 72, 136, 160, 241, 113,
					109, 223, 124, 255, 73, 191, 169, 227, 113, 7, 36, 236, 171, 217, 131, 138,
					4, 203, 124, 3, 151, 44, 102, 203, 60, 138, 68, 28, 104, 78, 138, 32,
					1, 137, 87, 253, 226, 63, 114, 217, 213, 251, 2, 73, 150, 51, 73, 100,
					184, 68, 240, 109, 110, 197, 217, 34, 18, 77, 12, 253, 152, 219, 148, 210,
					182, 7, 202, 73, 163, 180, 208, 246, 153, 154, 186, 241, 238, 126, 240, 220,
					14, 14, 102, 50, 75, 200, 161, 238, 67, 56, 184, 73, 181, 58, 178, 17,
					107, 231, 201, 3, 120, 111, 93, 70, 166, 157, 83, 167, 123, 46, 139, 102,
					47, 233, 164, 183, 207, 207, 251, 12, 6, 233, 117, 20, 126, 40, 100, 230,
					208, 240, 119, 32, 247, 222, 77, 180, 60, 32, 226, 168, 249, 49, 240, 30,
					53, 111, 88, 222, 238, 65, 141, 200, 199, 30, 66, 11, 145, 109, 12, 87,
					151, 196, 196, 29, 124, 148, 195, 195, 172, 118, 84, 239, 107, 67, 167, 50,
					37, 53, 67, 177, 27, 208, 130, 88, 38, 23, 219, 64, 158, 31, 241, 246}),
				new(Rotor).New(1787, 1379, 1579, []byte{
					148, 120, 9, 223, 187, 219, 81, 176, 67, 255, 147, 198, 62, 191, 137, 248,
					193, 125, 255, 243, 71, 239, 195, 192, 66, 213, 100, 195, 162, 116, 210, 227,
					197, 26, 4, 167, 139, 117, 116, 114, 144, 217, 182, 55, 154, 43, 7, 236,
					216, 131, 136, 236, 113, 246, 143, 183, 114, 71, 145, 42, 78, 247, 177, 209,
					222, 108, 233, 93, 88, 227, 215, 165, 179, 155, 173, 114, 159, 75, 242, 29,
					162, 143, 237, 228, 226, 37, 251, 235, 46, 55, 172, 120, 48, 10, 158, 180,
					165, 70, 19, 9, 100, 68, 124, 57, 98, 65, 229, 200, 206, 24, 211, 236,
					2, 41, 182, 159, 149, 158, 246, 151, 43, 77, 199, 166, 157, 112, 107, 80,
					151, 188, 19, 204, 141, 194, 57, 54, 134, 130, 208, 37, 126, 218, 223, 111,
					182, 74, 220, 128, 138, 95, 53, 200, 193, 172, 2, 131, 26, 243, 117, 234,
					157, 164, 41, 193, 152, 179, 107, 81, 18, 204, 211, 21, 156, 150, 53, 187,
					228, 31, 94, 6, 194, 178, 65, 180, 22, 201, 9, 198, 31, 124, 35, 75,
					109, 105, 39, 85, 175, 11, 80, 86, 157, 181, 2, 56, 76, 156, 30, 117,
					236, 161, 252, 198, 34, 239, 141, 0, 169, 74, 107, 206, 177, 145, 87, 160,
					196, 75, 248, 222, 221, 142, 130, 29, 250, 159, 52, 246, 249, 77, 196, 15,
					238, 251, 159, 63, 122, 31, 6, 22, 170, 38, 27, 22, 165, 147, 30, 47}),
				new(Permutator).New(256, []byte{
					2, 54, 236, 59, 71, 24, 38, 151, 82, 45, 214, 178, 37, 135, 46, 72,
					226, 87, 160, 25, 188, 122, 155, 109, 57, 95, 127, 93, 23, 202, 159, 217,
					175, 213, 198, 210, 34, 44, 230, 207, 197, 30, 77, 36, 120, 29, 154, 153,
					194, 62, 58, 240, 255, 158, 80, 123, 139, 114, 163, 149, 252, 136, 65, 143,
					215, 61, 88, 220, 182, 204, 205, 171, 174, 164, 73, 208, 78, 199, 8, 116,
					35, 250, 157, 172, 167, 113, 144, 166, 173, 242, 219, 203, 165, 132, 104, 195,
					92, 227, 251, 11, 129, 15, 209, 168, 76, 161, 243, 41, 22, 118, 111, 212,
					26, 5, 53, 187, 124, 231, 239, 97, 200, 229, 191, 10, 169, 98, 196, 145,
					179, 89, 4, 225, 216, 3, 128, 9, 112, 96, 186, 133, 221, 148, 162, 223,
					68, 237, 40, 28, 81, 121, 74, 52, 48, 189, 42, 99, 235, 150, 218, 241,
					101, 125, 108, 253, 248, 152, 137, 67, 55, 84, 211, 110, 50, 249, 134, 60,
					245, 185, 126, 56, 63, 206, 106, 18, 147, 20, 107, 69, 0, 234, 115, 176,
					21, 192, 117, 14, 16, 140, 170, 47, 138, 247, 105, 49, 228, 100, 64, 102,
					184, 7, 66, 233, 90, 183, 13, 232, 94, 12, 156, 91, 254, 246, 141, 27,
					222, 6, 19, 39, 224, 190, 238, 31, 32, 51, 33, 79, 146, 131, 119, 201,
					103, 180, 75, 130, 86, 83, 142, 17, 244, 85, 70, 181, 1, 177, 193, 43}),
				new(Rotor).New(1777, 608, 1259, []byte{
					149, 98, 118, 183, 12, 47, 237, 205, 33, 65, 254, 108, 62, 240, 199, 165,
					196, 94, 222, 204, 229, 249, 58, 84, 142, 210, 144, 57, 191, 110, 42, 56,
					178, 114, 35, 195, 179, 226, 19, 86, 213, 76, 225, 122, 26, 47, 206, 137,
					151, 121, 167, 136, 154, 244, 95, 200, 50, 100, 253, 37, 48, 50, 38, 135,
					200, 196, 141, 123, 9, 165, 203, 17, 187, 148, 27, 188, 251, 30, 165, 34,
					154, 218, 194, 214, 27, 35, 231, 128, 124, 49, 183, 80, 69, 202, 66, 69,
					179, 224, 53, 205, 167, 196, 1, 148, 63, 252, 54, 209, 191, 39, 1, 31,
					201, 68, 27, 23, 96, 157, 102, 245, 127, 4, 8, 20, 222, 53, 83, 209,
					186, 104, 171, 251, 71, 67, 42, 27, 140, 250, 220, 12, 78, 43, 102, 73,
					0, 101, 62, 198, 172, 108, 145, 214, 230, 91, 232, 85, 249, 18, 233, 89,
					127, 99, 54, 158, 144, 28, 210, 77, 197, 123, 60, 206, 218, 171, 94, 3,
					217, 107, 239, 190, 130, 86, 240, 26, 82, 208, 123, 30, 181, 181, 15, 76,
					220, 3, 158, 78, 243, 208, 223, 228, 94, 1, 157, 159, 143, 137, 89, 191,
					105, 192, 222, 5, 175, 163, 186, 45, 184, 241, 90, 98, 211, 12, 43, 197,
					236, 110, 25, 94, 218, 155, 67, 130, 252, 217, 124, 224, 143, 75, 137, 189,
					188, 153, 203, 243, 117, 168, 28, 165, 33, 115, 126, 221, 84, 112, 42, 170}),
				new(Rotor).New(1759, 862, 1697, []byte{
					227, 48, 174, 142, 237, 151, 79, 150, 10, 140, 77, 86, 93, 250, 103, 194,
					250, 11, 16, 102, 45, 87, 54, 19, 249, 103, 136, 183, 205, 7, 246, 233,
					189, 174, 36, 80, 71, 61, 41, 47, 5, 229, 17, 154, 81, 159, 65, 24,
					9, 238, 249, 126, 56, 43, 12, 162, 236, 163, 44, 213, 148, 147, 119, 50,
					197, 125, 240, 90, 22, 98, 24, 105, 147, 173, 42, 128, 255, 169, 80, 254,
					45, 156, 104, 19, 140, 121, 150, 88, 224, 38, 97, 94, 164, 29, 92, 126,
					91, 133, 134, 100, 236, 93, 66, 246, 157, 199, 29, 50, 215, 27, 95, 25,
					192, 246, 221, 169, 13, 213, 146, 160, 158, 35, 38, 23, 241, 255, 205, 222,
					97, 165, 144, 159, 47, 163, 51, 219, 51, 76, 58, 59, 50, 101, 65, 54,
					222, 216, 89, 134, 5, 9, 162, 250, 252, 139, 95, 87, 117, 91, 222, 163,
					49, 74, 214, 3, 242, 161, 169, 229, 82, 6, 194, 181, 87, 41, 4, 206,
					190, 117, 129, 113, 82, 246, 126, 147, 220, 141, 171, 79, 188, 85, 33, 33,
					50, 55, 228, 9, 26, 26, 8, 129, 137, 189, 98, 128, 55, 70, 170, 69,
					169, 46, 92, 201, 64, 85, 55, 184, 134, 174, 51, 131, 113, 24, 87, 199,
					246, 203, 39, 75, 5, 198, 38, 171, 46, 253, 51, 97, 253, 5, 8, 179,
					150, 43, 155, 137, 252, 51, 196, 219, 230, 3, 251, 244, 170, 142, 192, 217}),
				cnter},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if got := tntMachine.engine; !reflect.DeepEqual(got, tt.want) {
				t.Errorf("TntEngine.Engine() = %v, want %v", got, tt.want[:8])
			}
		})
	}
}

func TestTntEngine_MaximalStates(t *testing.T) {
	var tntMachine TntEngine
	tntMachine.Init([]byte("SecretKey"))
	want, _ := new(big.Int).SetString("7995790102247196352256", 10)
	tests := []struct {
		name string
		want *big.Int
	}{
		{
			name: "tteset1",
			want: want,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			e := tntMachine
			if got := e.MaximalStates(); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("TntEngine.MaximalStates() = %v, want %v", got, tt.want)
			}
		})
	}
}

func Test_createProFormaMachine(t *testing.T) {
	tests := []struct {
		name string
		want *[]Crypter
	}{
		{
			name: "tcpfm1",
			want: &[]Crypter{proFormaRotors[0], proFormaRotors[1], proFormPermutators[0], proFormaRotors[2], proFormaRotors[3], proFormPermutators[0], proFormaRotors[4], proFormaRotors[5]},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if got := createProFormaMachine(); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("createProFormaMachine() = %v, want %v", got, tt.want)
			}
		})
	}
}
